name: Release Finish

on:
  workflow_dispatch:
    inputs:
      release_version_name:
        description: 'Release branch'
        required: true
        type: string

jobs:
  close_release_branch:

    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: setup git config
        run: |
          # setup the username and email.
          git config user.name "GitHub Actions Bot"
          git config user.email "<android@dhis2.org>"

      - name: Merge release onto main
        run: |
          git checkout main
          git merge release/${{ inputs.release_version_name }}
          git push

      - name: Merge release onto develop
        run: |
          git checkout develop
          git merge release/${{ inputs.release_version_name }}
          git push

      - name: Delete release branch
        run: |
          git branch -d release/${{ inputs.release_version_name }}
          git push